function GameState(a,b,c){var g=this,i,j,k,n,m,l,o,d,f,h,p=0,c=1000/c,q=new Array(),r=new Array(a*b),s=new Array();g.mouseDown=false;g.mousePressed=false;g.keysDown=[];g.keysPressed=[];g.ctx = null;g.style=null;g.init=function(n){window.addEventListener('mousedown',function(e){if(!g.mouseDown)g.mousePressed=[e.pageX-g.ctx.canvas.parentNode.offsetLeft,e.pageY-g.ctx.canvas.parentNode.offsetTop];else g.mouseDown=[e.pageX-g.ctx.canvas.parentNode.offsetLeft,e.pageY-g.ctx.canvas.parentNode.offsetTop];},false);window.addEventListener('mouseup',function(e){g.mouseDown=false;},false);window.addEventListener('keydown',function(e){if (!g.keysDown[e.keyCode])g.keysPressed[e.keyCode]=true;else g.keysDown[e.keyCode]=true;},false);window.addEventListener('keyup',function(e){g.keysDown[e.keyCode]=false;},false);g.clearCollisionMap();j=document.getElementById(n);try{g.style = j.style;i = document.createElement('canvas');while(j.hasChildNodes())j.removeChild(j.firstChild);j.appendChild(i);g.ctx = i.getContext('2d');g.setResolution(a,b);return true;}catch(e){j.innerHTML='It looks like your browser doesn\'t support HTML5. Please upgrade to a modern browser like the latest versions of <a href="https://www.google.com/chrome">Google Chrome</a> or <a href="http://www.mozilla.org/en-US/firefox/new/">Mozilla Firefox</a>.';return false;}};g.start=function(){h=new Date();if(!d)return false;setInterval(function(){delete f;f=new Date();if((p+f.valueOf()-h.valueOf())>=(0|c)){p+=f.valueOf()-h.valueOf()-c;while(p>c)p-=c;delete h;h=f;for(i=0;i<s.length;i++)delete s[i];delete s;s=new Array();g.ctx.clearRect(0,0,a,b);d();if (s.length)for (k=0;k<s.length;k++){i=s[k][0];j=s[k][5];g.ctx.save();g.ctx.translate(s[k][1]+j*i.width/2,s[k][2]+j*i.height/2);g.ctx.rotate(s[k][3]);g.ctx.scale(j*(1-2*s[k][4]),j);g.ctx.drawImage(i,-i.width/2,-i.height/2);g.ctx.restore();}}},1);return true;};g.loadMode=function(i,j){for(k=0;k<q.length;k++)if(q[k][1]==j){q[k][0].destroy();delete q[k];q[k]=[i,j];return;}q.push([i,j]);};g.setMode=function(i){for(k=0;k<q.length;k++)if(q[k][1]==i)break;q[k][0].init();};g.getSprite=function(o){l=new Array();j=GameState.spriteInfo;for(i=0;i<j.length;i++)if(j[i].name==o){i=j[i];break;}for(n=0;n<i.sprite.length;n++){j=new Array();for(k=0;k<i.sprite[n].frames;k++){m=new Image();m.src='res/img/sprites/'+o+'/'+i.sprite[n].name+'/'+k+'.png';j.push(m);}l.push([new N(j,i.sprite[n]),i.sprite[n].name]);}return new M(l);};g.getImage=function(j){i=new Image();i.src='res/img/static/'+j+'.png';return i;};function M(D){var A=D.length,B,C;this.setAnim=function(i){for(k=0;k<A;k++)if(D[k][1]==i)break;B=D[k][0];B.Z();};this.draw=function(j,k,l,m,n){s.push([B.Y(),j,k,l,m,n]);C=B.X();if(C)this.setAnim(C);};this.destroy=function(){for(k=0;k<A;k++)D[k].Q();delete this;};};function N(A,B){var C=0,D=0,E=B.next,F=new Array(),G=new Array();for(k=0;k<B.frames;k++){F.push(B.durations[k]);G.push(new Array(2));G[k][0]=B.origins[k][0];G[k][1]=B.origins[k][1];}this.Z=function(){C=D=0;};this.X=function(){D++;if(D>=F[C]){D=0;C++;if (C==A.length){C=0;return E;}}return false;};this.Y=function(){return A[C];};this.Q=function(){for(k=0;k<B.frames;k++){delete A[k];delete G[k];}delete G;delete F;delete this;};};g.getWidth=function(){return a;};g.getHeight=function(){return b;};g.setScreen=function(i){g.mousePressed=false;g.keysPressed=[];d=i;};g.setResolution=function(x,y,i,j){a=0|(b*x/y);if(i){x=window.innerWidth;y=window.innerHeight;if(!j){if(window.innerWidth/a>window.innerHeight/b)x=0|(a*y/b);else y=0|(b*x/a);}}g.ctx.canvas.width=x;g.ctx.canvas.height=y;g.ctx.scale(x/a,y/b);g.ctx.strokeStyle='rgb(255,255,255)';g.ctx.fillStyle='rgb(255,255,255)';g.style.left="50%";g.style.top="50%";g.style.marginLeft="-"+(g.ctx.canvas.width/2)+"px";g.style.marginTop="-"+(g.ctx.canvas.height/2)+"px";};g.setCollision=function(x,y,n){if(x>=0&&y>=0&&x<a&&y<b)r[y*a+x]=n;};g.getCollision=function(x,y){if(x>=0&&y>=0&&x<a&&y<b)return r[y*a+x];else return false;};g.clearCollisionMap=function(){for(i=0;i<a;i++)for(j=0;j<=b;j++)r[j*a+i]=false;};g.destroy=function(){for(i=0;i<s.length;i++)delete s[i];delete s;for(i=0;i<q.length;i++)q[i][0].destroy();delete q;delete r;delete f;delete h;delete g;};}